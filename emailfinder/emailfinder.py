import sys
import re

import requests
from bs4 import BeautifulSoup

E = []
TC = []
C = set()

def request(url):
    if url.startswith("https://") == False | url.startswith("http://") == False:
        print("Coloque \"https://\" ou \"http://\"")
        sys.exit(0)
    header = {"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0"}
    try:
        r = requests.get(url, headers=header)
        return r.text
    except KeyboardInterrupt:
        sys.exit(0)
    except:
        pass


def get_l(html):
    links = []
    try:    
        soup = BeautifulSoup(html, "html.parser")
        refs = soup.find_all("a", href=True)
        for ref in refs:
            link = ref["href"]
            if link.startswith("http"):
                links.append(link)
        return links
    except:
        pass


def get_E(html):
    emails = re.findall(r"\w[\w\.]+\w@\w[\w\.]+\w", html)   
    return emails    


def c():
    try:
        while 1:
            if TC:
                url = TC.pop()

                html = request(url)
                if html:
                    links = get_l(html)
                    if links:
                        for link in links:
                            if link not in C and link not in TC:
                                TC.append(link)

                    emails = get_E(html)
                    for email in emails:
                        if email not in E:
                            print("[ + ] Found: {}".format(email))
                            E.append(email)

                    C.add(url)
                else:
                    C.add(url)
            else:
                print("Done")
                break
    except KeyboardInterrupt:
        print("\n Keyboard Interrupt")
    except:
        pass


if __name__ == "__main__":
    if len(sys.argv) <= 1:
        print("")
        print("===============================")
        print("##        EMAIL FINDER       ##")
        print("===============================")
        print("")
        print("Use: python emailfinder.py <url>")
        sys.exit(0)
    url = sys.argv[1]
    TC.append(url)
    c()    